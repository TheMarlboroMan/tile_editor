#Tile editor

A map-level editor for tile based applications. This perfectly represents the aftertought after aftertought school of design, so the code is a wild mess.

It supports:

- Up to 6 (completely arbitrary) layers of tiles. Each one can have a different tileset and sizes.
- Up to 6 layers of logic objects. Each one can feed from a custom object notation.
- Basic meta-property editor, key-value pairs.
- In-application help (accesible by pressing F1).

#Building

This project depends on libdansdl2.a and herramientas_proyecto, both available on https://github.com/TheMarlboroMan/

In order to compile, you need:

- libdansdl2.a, classic branch.
- herramientas_proyecto, classic branch.

Just in case, I added the neccesary dependencies in the "dependencies" folder... This is old software, unlikely to get updated, as I'd rather write it again.

For its input, it needs sprite sheets generated by this other tool:
	https://github.com/TheMarlboroMan/tabla_sprites

I am not sure this builds on Windows. There are many std::to_string shortcuts around and these tend to fail with mingw32.

##How to use

To get the application to work, you need a valid configuration file... The configuration file points to at least a single tileset data and a single object data. In case of failure, try checking the logs in data/logs.

Pressing F1 in the application brings up a help screen.

If you want to use the bundled example:

	./a.out res=800x600 out=ejemplo/result.dat cfg=ejemplo/config.dat

Notice that in this weird example, config.dat does point to other files, such as the tileset (tile.dat), its corresponding picture (default_tiles.png) and the logic objects configuration (objetos_config.dat).

Example configuration files are provided in the "ejemplo" directory... There is an example tileset in data/graficos.

Here follows a translation of the output of the tool, when used without parameters:

Use: executable res=WxH out=output_file cfg=config_file
	./a.out res=800x600 out=out.dat cfg=config.dat

PARAMETERS:
	res: Screen resolution expressed as width x height.
	out: Name of the output file. If the file exists, the map will be loaded.
	cfg: Name of the configuration file, made up of N lines with this format:

		T	sprite_sheet_name	comment_character	|	path_to_graphics	alpha	r_value_for_alpha	g_value_for_alpha	b_value_for_alpha
		O	path_to_object_definition

	The first T or O characters determine if the line defines a set of tiles or a set of objects. All sets specified will be loaded.

	Sprite sheets are generated with the "editor_sprites" tool.

	Object format is:
		id	name	width	height	default_color
			property_name	default_color
			property_name	default_color
			property_name	default_color
		id	name	width	height	default_color
			property_name	default_color
		[...]

##Output file format...

The thing does output in dnot (think json... before it was fashionable) but a classic version used this structure:

!Begin data. Only thing that closes, actually.
[ESTRUCTURA] 
!Info block.
[INFO]
!First number indicates number of tile layers. Second indicates number of object layers.
1,1
!Init meta. Meta is a set of "key" and "value" completely dependant on the user.
[META]
categoria:1
ESTADO:"ACTIVO"
detonado:true
!End meta.
[/META]
!Begin grid matrix
[REJILLA]
!Width and height of the matrix, width and height of each cell, number of cells to get an horizontal or vertical separator, tileset used.
14,11,32,32,8,8,0
!Begin cells
[CELDAS]
!Groups of x, y and type.
0,0,64 1,0,78 2,0,78 3,0,78 4,0,78 5,0,78 6,0,1 7,0,1 8,0,78 9,0,78 10,0,78 11,0,78 12,0,78 13,0,64 0,1,44 1,1,73 2,1,73 3,1,73 4,1,73 5,1,73 6,1,68 7,1,68 8,1,73 9,1,73 10,1,73 11,1,73 12,1,73 13,1,44 0,2,44 1,2,5 2,2,6 3,2,6 4,2,6 5,2,6 6,2,9 7,2,9 8,2,6 9,2,6 10,2,6 11,2,6 12,2,7 13,2,44 0,3,44 1,3,8 2,3,17 3,3,12 4,3,12 5,3,12 6,3,12 7,3,12 8,3,12 9,3,12 10,3,12 11,3,18 12,3,10 13,3,44 0,4,44 1,4,8 2,4,10 11,4,8 12,4,10 13,4,44 0,5,44 1,5,8 2,5,10 3,5,78 4,5,78 5,5,78 6,5,78 7,5,78 8,5,78 9,5,78 10,5,78 11,5,8 12,5,10 13,5,44 0,6,44 1,6,8 2,6,10 3,6,73 4,6,75 5,6,73 6,6,73 7,6,77 8,6,73 9,6,75 10,6,73 11,6,8 12,6,10 13,6,44 0,7,44 1,7,8 2,7,9 3,7,9 4,7,9 5,7,9 6,7,9 7,7,9 8,7,9 9,7,9 10,7,9 11,7,9 12,7,10 13,7,44 0,8,44 1,8,11 2,8,12 3,8,12 4,8,12 5,8,12 6,8,9 7,8,9 8,8,12 9,8,12 10,8,12 11,8,12 12,8,13 13,8,44 0,9,44 1,9,44 2,9,44 3,9,44 4,9,44 5,9,44 6,9,66 7,9,66 8,9,44 9,9,44 10,9,44 11,9,44 12,9,44 13,9,44 0,10,63 1,10,63 2,10,63 3,10,63 4,10,63 5,10,63 6,10,2 7,10,2 8,10,63 9,10,63 10,10,63 11,10,63 12,10,63 13,10,63
!Begin logic
[LOGICA]
!Index of the logic object list to use.
0
!Begin objects
[OBJETOS]
!Groups of type, x, y and values for properties.
1,224,160,1,32
!An alternative notation includes names and values for the properties separated by ":".
1,224,160,propa:1,propb:32
!End data
[/ESTRUCTURA]

The [REJILLA] + [CELDAS] structure repeats once for each layer, same as the [LOGICA] + [OBJETOS] one.

The dnot structure is different, but symbolises the same data.

//TODO!!!!!!

##History

- As of November 5th, 2015, the tool has been patched with a compatibility layer to support the many changes made to the original libdansdl2. Should the tool be updated, the compatibility layer will be removed. The tool now needs the SDL2_ttf library to link with (even though it's not used).
- As of July 2017 the dependencies have been added and the project has been patched to work with the bundled dependencies.-
- 19-7-2017: Added keyboard tile selection shortcuts.
- 21-7-2017: Many changes...
	- Added grid and file properties dialog.
	- Added also a little message in the bottom, to know what you are doing.
	- Fixed bug in tile selection shortcut.
	- Added background to tile selection list, to make it more usable.
	- Removed old bracket input to change tiles.
- 22-7-2017: Many more changes.
	- Added dnot export. Still not 100% functional.
	- Changed the way how properties work in objects, using a simple key->value sequence instead of the numerical index thing.

##Todo

- Document the file format in dnot.
- Do dnot import.

##Bugs

- There's a bug in the selector of tiles-objects, try changing layers.
- Fix tile page bug (try to switch pages with keyboard shortcuts).
